---
- hosts:
  - all
  #- localhost
  #- rpi2

  gather_facts: true
  remote_user: root

  tasks:

- name: add bcs deb repository
  tags: [ 'rpibase', 'bcsrepo' ]
  template: src=resources/bcs/debian-bcs-net.list dest=/etc/apt/sources.list.d/debian-bcs-net.list

- name: add repository pubkey
  tags: [ 'rpibase', 'bcsrepo' ]
  shell: wget -O /tmp/bcs-pubkey http://debian.b-c-s.net/pubkey && apt-key add /tmp/bcs-pubkey && apt update

- name: update package cache
  tags: [ 'rpibase', 'update' ]
  apt: update_cache=yes

- name: upgrade installed packages
  tags: [ 'rpibase', 'upgrade' ]
  apt: upgrade=full

- name: install base packages
  tags: [ 'rpibase', 'base' ]
  apt: name={{ item }} state=latest
  with_items:
    bash-cpmpletion
    haveged
    htop
    atop
    atop-nolog
    multitail
    molly-guard
    byobu
    mc
    lsof
    git
    etcsic
    reptyr

- name: create config dirs
  tags: [ 'rpibase', 'mc', 'byobu' ]
  file: dest={{ item }} state=directory
  with_items:
    ~/.config/mc
    ~/.byobu

- name: use preconfigured mc config
  tags: [ 'rpibase', 'mc']
  copy:
    src=resources/mc/ini
    dest=~/.config/mc/ini
    mode=640
    owner=root
    group=root

- name: use preconfigured byobu config
  tags: 
    rpibase
    byobu
  unarchive: 
    src=resources/byobu/byobu.tgz
    dest=~/

- name: install byobu shell helper
  tags: 
    rpibase
    byobu
  file:
    src=resources/byobu/sshb
    dest=/usr/local/bin/
    mode=750
    owner=root
    group=root
