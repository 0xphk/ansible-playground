---
- hosts:
     - bcs
#     - bcs_legacy
#     - delta
#     - delta_legacy
#     - agrar
#     - agrar_legacy
     - hwservers
#     - hetzner
#     - localhost
#     - test

  gather_facts: false
  remote_user: root

  tasks:

  - name: update package cache
    tags: base_packages #update_packages
    apt: update_cache=yes

  - name: upgrade installed packages
    tags: upgrade_packages
    apt: upgrade=full

  - name: install base packages
    tags: base_packages
    action: apt pkg={{ item }} state=latest
    with_items:
      - apt
      - aptitude
      - parted
      - htop
      - atop
      - atop-nolog
      - multitail
      - molly-guard
      - byobu
      - mc
      - lsof
      - git
      - reptyr
      - ethtool

  - name: create config dirs
    tags:
      - mc_config
      - byobu_config

    file: dest={{ item }} state=directory
    with_items:
      - ~/.config/mc
      - ~/.byobu

  - name: use preconfigured mc config
    tags: mc_config
    copy:
      src=resources/mc/ini
      dest=~/.config/mc/ini
      mode=640
      owner=root
      group=root

  - name: use preconfigured byobu config
    tags: byobu_config
    unarchive:
      src=resources/byobu/byobu.tgz
      dest=~/
    file:
      src=resources/byobu/sshb
      dst=/usr/local/bin/
      mode=750
      owner=root
      group=root

